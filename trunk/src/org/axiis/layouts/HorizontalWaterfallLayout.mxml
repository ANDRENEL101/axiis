<?xml version="1.0" encoding="utf-8"?>
<layouts:BaseLayout xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:degrafa="http://www.degrafa.com/2007"
	xmlns:layouts="org.axiis.layouts.*" xmlns:scale="org.axiis.layouts.scale.*" xmlns:core="org.axiis.core.*">
	
	<mx:Script>
		<![CDATA[
			private function computeY(iteration:int,property:Number):Number
			{
				if(dataItems.length == 0 || iteration == 0 || iteration == dataItems.length - 1)
					return 0;
				
				var currValue:Number = dataItems[iteration][dataField];
				var prevValue:Number = dataItems[iteration - 1][dataField];
				var delta:Number = currValue - prevValue;
				return delta > 0
					? linearScale.valueToLayout(prevValue)
					: linearScale.valueToLayout(currValue);
					
				return toReturn;
			}
			
			private function computeHeight(iteration:int,property:Number):Number
			{
				if(dataItems.length == 0)
					return 0;
				
				var currValue:Number = dataItems[iteration][dataField];
				if(iteration == 0 || iteration == dataItems.length - 1)
				{
					return linearScale.valueToLayout(currValue);
				}
				else
				{				
					var prevValue:Number = dataItems[iteration - 1][dataField];				
					var delta:Number = Math.abs(currValue - prevValue);
					return linearScale.valueToLayout(delta);
				}
			}
		]]>
	</mx:Script>
	
	<mx:String id="dataField"/>
	
	<scale:LinearScale id="linearScale" 
		dataProvider="{dataProvider}"
		dataField="{dataField}"
		minValue="0" 
		minLayout="0"
		maxLayout="{height}"/>
	
	<layouts:referenceRepeater> 
		<core:GeometryRepeater dataProvider="{dataItems}">
			<core:geometry>
				<degrafa:RegularRectangle x="0" y="0" width="{width / itemCount - 5}" height="{height}"/>
			</core:geometry>
			<core:modifiers>
				<core:PropertyModifier property="x" modifierOperator="add" modifier="{width / itemCount}"/>
				<core:PropertyModifier property="y" modifierOperator="none" modifier="{computeY}"/>
				<core:PropertyModifier property="height" modifierOperator="none" modifier="{computeHeight}"/>
			</core:modifiers>
		</core:GeometryRepeater>
	</layouts:referenceRepeater>
	
</layouts:BaseLayout>
