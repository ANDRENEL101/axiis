<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:charts="org.axiis.charts.*" 
	layout="absolute"  backgroundGradientColors="[0xDDDDDD,0xF5F5F5]"
	creationComplete="start();" 
	xmlns:axiis="http://www.axiis.org/2009" xmlns:series="org.axiis.charts.series.*" xmlns:groupings="org.axiis.charts.groupings.*" xmlns:degrafa="http://www.degrafa.com/2007" xmlns:states="org.axiis.states.*" xmlns:paint="org.axiis.paint.*" xmlns:Examples="Examples.*" xmlns:axis="org.axiis.charts.axis.*" xmlns:labels="org.axiis.charts.labels.*">

<mx:Style source="styles/Axiis_Examples.css"/>
<mx:Script>
		<![CDATA[
			import org.axiis.data.DataSet;
			
			use namespace mx_internal;
			
			private var ds:DataSet = new DataSet();
			
			public function start():void
			{ 
				ds.processXmlString(countryData);
				//Aggregate the detailed data items
				ds.aggregateData(ds.data.object,"country.medal",["count"]);
				//Aggegate the higher level items
				ds.aggregateData(ds.data.object,"country",["aggregates.medal_count_sum"]);
				vScale.maxValue=ds.data.object.aggregates['country_aggregates:medal_count_sum_max'];
				dataProvider=ds.data.object.country;
				
				dc.invalidateDisplayList();
				
			//	var doc:Object=this.document;
			//	var bindings:Array=doc._bindings;
			//	mx.binding.BindingManager.setEnabled(doc,false);
			}
			
			
		]]>
</mx:Script>
<Examples:ExampleBackground width="{this.width}" height="{this.height}"/>
<mx:Label fontSize="22" fontFamily="Myriad Pro" htmlText="&lt;b&gt;Axiis&lt;/b&gt; - Horizontal Chart" top="20" right="30" color="0xFFFFFF"/>
<mx:Label fontSize="14" fontFamily="Myriad Pro" htmlText="Clusters and Stacks" top="50" right="30" color="0xFFFFFF" alpha=".9"/>

<mx:String id="countryData" source="data/2008_Olympics_Large.xml"/>
<!--mx:String id="countryData" source="data/2008_Olympics.xml"/-->

<!--  GLOBAL VARIABLES -->
<mx:Object id="dataProvider"/>
<mx:String id="verticalField"/>
<mx:String id="dataField">medal</mx:String>
<mx:String id="labelField">name</mx:String>
<mx:String id="childDataField">count</mx:String>
<mx:String id="childLabelField">category</mx:String>
<mx:Number id="percentGap">.02</mx:Number>

	<axiis:LinearScale dataProvider="{dataProvider}" minLayout="0" maxLayout="{hLayout.height}" id="vScale"/>

	<!--
	<mx:VBox color="white" bottom="0">
		<mx:Repeater id="layoutRepeater" dataProvider="{[verticalAxis,hLayout,myCluster,myStack]}">
			<local:LayoutControls layout="{BaseLayout(layoutRepeater.currentItem)}"/>
		</mx:Repeater>
		<mx:Button click="dc.invalidateDisplayList()" label="Render"/>
	</mx:VBox>
	-->
	
	<mx:Label text="{hLayout.rendering ? 'Refreshing...' : ''}" width="100%" textAlign="center" bottom="5"/>
	
	<axiis:DataCanvas height="{this.height*.5}" width="{this.width*.8}" id="dc" verticalCenter="0" horizontalCenter="0" showDataTips="true"
		 strokes="{strokes}" fills="{fills}" palettes="{palettes}">
	
		<!-- Background -->
		<axiis:backgroundGeometries>
			<axis:VAxis id="verticalAxis"
				verticalScale="{vScale}" tickStroke="{axisStroke}" width="{dc.width}"  height="{hLayout.height}" emitDataTips="false"
				 fontFamily="Myriad Pro" fontColor="0" fontSize="14" tickGap="5"/>
		</axiis:backgroundGeometries>
	
		<!-- Layouts -->
		<axiis:layouts>
			<axiis:HBoxLayout id="hLayout" x="25" y="0"  height="{dc.height-70}" width="{dc.width-25}" percentGap="{percentGap}" 
					dataProvider="{dataProvider}" dataField="{dataField}" labelField="{labelField}">
				<axiis:layouts>
					
					<!-- Cluster Group --> 
					<groupings:ColumnCluster id="myCluster" width="{hLayout.currentReference.width*.83}" height="{hLayout.currentReference.height}" y="0" x="0"
						dataProvider="{hLayout.currentValue}" dataField="{childDataField}" labelField="{childLabelField}" percentGap=".07"
						fill="{clusterFill}" stroke="{colStroke}" verticalScale="{vScale}" fontFamily="Myriad Pro" fontColor="{outerPalette.currentColor}" />
					
					<!-- Stack Group (same data) -->
					<groupings:ColumnStack id="myStack" x="{hLayout.currentReference.width*.85}" y="0"
						width="{hLayout.currentReference.width*.15}" height="{hLayout.currentReference.height}" 
						dataProvider="{hLayout.currentValue}" dataField="{childDataField}" labelField="{childLabelField}" 
						fill="{stackFill}" stroke="{colStroke}" verticalScale="{vScale}" fontFamily="Arial" showLabel="false">
						<groupings:states>
							<axiis:State targets="{[myStack]}"
								properties="['fill']"
								enterStateEvent="mouseOver"
								exitStateEvent="mouseOut">
								<axiis:values>
									<mx:Array>
										<degrafa:SolidFill color="0xffff00"/>
									</mx:Array>
								</axiis:values>
							</axiis:State>
						</groupings:states>
					</groupings:ColumnStack>

				</axiis:layouts>
				
				<!-- Bottom Bracket -->
				<axiis:drawingGeometries>
					<labels:HBracket width="{hLayout.currentReference.width}" height="60" fontFamily="Myriad Pro" fontSize="14" fontColor="{outerPalette.currentColor}" 
						y="{hLayout.height+5}" x="{hLayout.currentReference.x}" labelValue="{hLayout.currentLabel}" markerStroke="{myStroke}"/>
				</axiis:drawingGeometries>
				
			</axiis:HBoxLayout>
		</axiis:layouts>
	</axiis:DataCanvas>
	
	<mx:Array id="palettes">
		<paint:LayoutPalette id="outerPalette" target="{hLayout}" colorFrom="0xCC3333" colorTo="0x3333CC"/>
		<paint:LayoutPalette id="clusterPalette" target="{myCluster}" colorFrom="{outerPalette.currentColor}" colorTo="{outerPalette.currentColor | 0x337f00}"/>
		<paint:LayoutPalette id="stackPalette" target="{myStack}" colorFrom="{outerPalette.currentColor}" colorTo="{outerPalette.currentColor | 0x337f00}"/>
	</mx:Array>
	<mx:Array id="fills">
		<degrafa:LinearGradientFill id="clusterFill" angle="45">
			<degrafa:GradientStop color="{clusterPalette.currentColor}"/>
			<degrafa:GradientStop color="{clusterPalette.currentColor | 0x333333}" alpha=".85"/>
		</degrafa:LinearGradientFill>
		<degrafa:LinearGradientFill id="stackFill" angle="90">
			<degrafa:GradientStop color="{stackPalette.currentColor}"/>
			<degrafa:GradientStop color="{stackPalette.currentColor | 0x333333}" alpha=".7"/>
		</degrafa:LinearGradientFill>
	</mx:Array>
	<mx:Array id="strokes">
		<degrafa:LinearGradientStroke  id="colStroke" pixelHinting="true" angle="45">
			<degrafa:GradientStop color="0xFFFFFF" alpha=".7"/>
			<degrafa:GradientStop color="0xFFFFFF" alpha=".3"/>
		</degrafa:LinearGradientStroke>
		<degrafa:SolidStroke color="0xFFFFFF" alpha=".3"/>
		<degrafa:SolidStroke color="0x222222" id="axisStroke" pixelHinting="true"/>
		<degrafa:SolidStroke color="{outerPalette.currentColor}" id="myStroke" alpha=".5"/>
		<degrafa:SolidStroke color="{outerPalette.currentColor}" id="myStroke2" alpha=".7" weight="6" caps="none"/>
	</mx:Array>
	
</mx:Application>